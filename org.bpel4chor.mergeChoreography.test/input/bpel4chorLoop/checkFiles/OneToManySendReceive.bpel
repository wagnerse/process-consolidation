<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://www.iaas.uni-stuttgart.de"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract" xmlns:ns="http://www.iaas.uni-stuttgart.de">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="Airline.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="Agency.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <variables>
        <variable messageType="ns:RequestPrice" name="varInv1"/>
    </variables>
    <flow name="MergedFlow">
        <links>
            <link name="RequestPriceTOReceiveFromAgency"/>
            <link name="RequestPrice1TOReceiveFromAgency1"/>
        </links>
        <scope exitOnStandardFault="yes" name="Scope_Lufthansa" suppressJoinFailure="yes">
            <variables>
                <variable name="AirlineInput"/>
                <variable messageType="ns:RequestPrice" name="varRec2"/>
                <variable messageType="ns:ReplyPrice" name="varInv2"/>
                <variable messageType="ns:AirlineResponseMessage" name="output"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="AirlineProvider" name="client"
                    partnerLinkType="ns:Airline" partnerRole="AirlineRequester"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="Link2"/>
                    <link name="ReceiveToEmpty"/>
                    <link name="EmptyToInvoke"/>
                </links>
                <receive createInstance="yes" name="receive" variable="AirlineInput">
                    <sources>
                        <source linkName="Link2"/>
                    </sources>
                </receive>
                <empty name="ReceiveFromAgency">
                    <targets>
                        <joinCondition><![CDATA[$RequestPriceTOReceiveFromAgency and ($Link2)]]></joinCondition>
                        <target linkName="Link2"/>
                        <target linkName="RequestPriceTOReceiveFromAgency"/>
                    </targets>
                    <sources>
                        <source linkName="ReceiveToEmpty"/>
                    </sources>
                </empty>
                <empty name="EmptyActivity">
                    <targets>
                        <target linkName="ReceiveToEmpty"/>
                    </targets>
                    <sources>
                        <source linkName="EmptyToInvoke"/>
                    </sources>
                </empty>
                <empty name="ReplyPrice">
                    <targets>
                        <target linkName="EmptyToInvoke"/>
                    </targets>
                </empty>
            </flow>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_Agency" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:AgencyRequestMessage" name="input"/>
                <variable messageType="ns:AgencyResponseMessage" name="output"/>
                <variable messageType="ns:ReplyPrice" name="varRec1"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="AgencyProvider" name="client"
                    partnerLinkType="ns:Agency" partnerRole="AgencyRequester"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="Link1"/>
                    <link name="Link11"/>
                </links>
                <receive createInstance="yes" name="receive" variable="input">
                    <sources>
                        <source linkName="Link1"/>
                    </sources>
                </receive>
                <flow name="RequestPriceFE_UnrolledLoop">
                    <targets>
                        <target linkName="Link1"/>
                    </targets>
                    <sources>
                        <source linkName="Link11"/>
                    </sources>
                    <links/>
                    <scope exitOnStandardFault="no" isolated="no" name="RequestPriceFEScope">
                        <flow name="RequestPriceFEFlow">
                            <links/>
                            <empty name="RequestPrice">
                                <sources>
                                    <source linkName="RequestPriceTOReceiveFromAgency"/>
                                </sources>
                            </empty>
                        </flow>
                    </scope>
                    <scope exitOnStandardFault="no" isolated="no" name="RequestPriceFEScope1">
                        <flow name="RequestPriceFEFlow">
                            <links/>
                            <empty name="RequestPrice1">
                                <sources>
                                    <source linkName="RequestPrice1TOReceiveFromAgency1"/>
                                </sources>
                            </empty>
                        </flow>
                    </scope>
                </flow>
                <flow name="ReplyPriceFE_UnrolledLoop">
                    <targets>
                        <target linkName="Link11"/>
                    </targets>
                    <links/>
                    <scope exitOnStandardFault="no" isolated="no" name="ReplyPriceFEScope">
                        <flow name="ReplyPriceFEFlow">
                            <links/>
                            <empty name="ReceiveFromAirline"/>
                        </flow>
                    </scope>
                    <scope exitOnStandardFault="no" isolated="no" name="ReplyPriceFEScope1">
                        <flow name="ReplyPriceFEFlow">
                            <links/>
                            <empty name="ReceiveFromAirline1"/>
                        </flow>
                    </scope>
                </flow>
            </flow>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_Emirates" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:AirlineResponseMessage" name="output"/>
                <variable name="Emirates_AirlineInput"/>
                <variable messageType="ns:RequestPrice" name="Emirates_varRec2"/>
                <variable messageType="ns:ReplyPrice" name="Emirates_varInv2"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="AirlineProvider" name="client"
                    partnerLinkType="ns:Airline" partnerRole="AirlineRequester"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="Link2"/>
                    <link name="ReceiveToEmpty"/>
                    <link name="EmptyToInvoke"/>
                </links>
                <receive createInstance="yes" name="receive" variable="Emirates_AirlineInput">
                    <sources>
                        <source linkName="Link2"/>
                    </sources>
                </receive>
                <empty name="ReceiveFromAgency1">
                    <targets>
                        <joinCondition><![CDATA[$RequestPrice1TOReceiveFromAgency1 and ($Link2)]]></joinCondition>
                        <target linkName="Link2"/>
                        <target linkName="RequestPrice1TOReceiveFromAgency1"/>
                    </targets>
                    <sources>
                        <source linkName="ReceiveToEmpty"/>
                    </sources>
                </empty>
                <empty name="EmptyActivity">
                    <targets>
                        <target linkName="ReceiveToEmpty"/>
                    </targets>
                    <sources>
                        <source linkName="EmptyToInvoke"/>
                    </sources>
                </empty>
                <empty name="ReplyPrice1">
                    <targets>
                        <target linkName="EmptyToInvoke"/>
                    </targets>
                </empty>
            </flow>
        </scope>
    </flow>
</process>
