<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://www.iaas.uni-stuttgart.de"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract"
    xmlns:ns="http://www.iaas.uni-stuttgart.de" xmlns:ns0="http://www.w3.org/2001/XMLSchema">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="Process2.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="Process1.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <variables>
        <variable name="initiate2" type="ns:InitiateMessage"/>
        <variable messageType="ns:CallLinkMessage" name="varRec2"/>
        <variable messageType="ns:ReplyLinkMessage" name="varRec1"/>
    </variables>
    <flow name="MergedFlow">
        <links>
            <link name="InvokeTOInitCounter2"/>
            <link name="SLOOP_Invoke1Process1TOReceive2Process21"/>
            <link name="SLOOP_Invoke1Process1TOReceive2Process22"/>
            <link name="SLOOP_Invoke2Process2TOReceive1Process11"/>
            <link name="SLOOP_Invoke2Process2TOReceive1Process12"/>
        </links>
        <scope exitOnStandardFault="yes" name="Scope_Process2" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:Process2RequestMessage" name="input"/>
                <variable messageType="ns:Process2ResponseMessage" name="output"/>
                <variable messageType="ns:ReplyLinkMessage" name="varInv2"/>
                <variable name="counter2" type="ns0:string"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="Process2Provider" name="client2"
                    partnerLinkType="ns:Process2PLT" partnerRole="Process2Requester"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="Assign2ToWhile2"/>
                </links>
                <assign name="InitCounter2" validate="no">
                    <targets>
                        <target linkName="InvokeTOInitCounter2"/>
                    </targets>
                    <sources>
                        <source linkName="Assign2ToWhile2"/>
                    </sources>
                    <copy>
                        <from>
                            <literal>0</literal>
                        </from>
                        <to variable="counter2"/>
                    </copy>
                </assign>
                <flow name="UnrolledLoop">
                    <targets>
                        <target linkName="Assign2ToWhile2"/>
                    </targets>
                    <links>
                        <link name="SLOOP_Process2While_Entry"/>
                        <link name="SLOOP_Next1"/>
                    </links>
                    <empty name="EntryActivity">
                        <sources>
                            <source linkName="SLOOP_Process2While_Entry">
                                <transitionCondition><![CDATA[$counter2 < 1]]></transitionCondition>
                            </source>
                        </sources>
                    </empty>
                    <flow name="Process2WhileFlow1">
                        <targets>
                            <target linkName="SLOOP_Process2While_Entry"/>
                        </targets>
                        <sources>
                            <source linkName="SLOOP_Next1">
                                <transitionCondition><![CDATA[$counter2 < 1]]></transitionCondition>
                            </source>
                        </sources>
                        <links>
                            <link name="SLOOP_Receive2ToAssign1"/>
                            <link name="SLOOP_AssignToInvoke21"/>
                        </links>
                        <empty name="Receive2Process2">
                            <targets>
                                <target linkName="SLOOP_Invoke1Process1TOReceive2Process21"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_Receive2ToAssign1"/>
                            </sources>
                        </empty>
                        <assign name="IncrementInput" validate="no">
                            <targets>
                                <target linkName="SLOOP_Receive2ToAssign1"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_AssignToInvoke21"/>
                            </sources>
                            <copy>
                                <from><![CDATA[$counter2 + 1]]></from>
                                <to variable="counter2"/>
                            </copy>
                        </assign>
                        <assign name="Invoke2Process2" validate="no">
                            <targets>
                                <target linkName="SLOOP_AssignToInvoke21"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_Invoke2Process2TOReceive1Process11"/>
                            </sources>
                            <copy>
                                <from variable="varInv2"/>
                                <to variable="varRec1"/>
                            </copy>
                        </assign>
                    </flow>
                    <flow name="Process2WhileFlow2">
                        <targets>
                            <target linkName="SLOOP_Next1"/>
                        </targets>
                        <links>
                            <link name="SLOOP_Receive2ToAssign2"/>
                            <link name="SLOOP_AssignToInvoke22"/>
                        </links>
                        <empty name="Receive2Process2">
                            <targets>
                                <target linkName="SLOOP_Invoke1Process1TOReceive2Process22"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_Receive2ToAssign2"/>
                            </sources>
                        </empty>
                        <assign name="IncrementInput" validate="no">
                            <targets>
                                <target linkName="SLOOP_Receive2ToAssign2"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_AssignToInvoke22"/>
                            </sources>
                            <copy>
                                <from><![CDATA[$counter2 + 1]]></from>
                                <to variable="counter2"/>
                            </copy>
                        </assign>
                        <assign name="Invoke2Process2" validate="no">
                            <targets>
                                <target linkName="SLOOP_AssignToInvoke22"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_Invoke2Process2TOReceive1Process12"/>
                            </sources>
                            <copy>
                                <from variable="varInv2"/>
                                <to variable="varRec1"/>
                            </copy>
                        </assign>
                    </flow>
                </flow>
            </flow>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_Process1" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:Process1RequestMessage" name="input"/>
                <variable messageType="ns:Process1ResponseMessage" name="output"/>
                <variable messageType="ns:CallLinkMessage" name="varInv1"/>
                <variable name="initiate1" type="ns:InitiateMessage"/>
                <variable name="counter1" type="ns0:string"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="Process1Provider" name="client"
                    partnerLinkType="ns:Process1PLT" partnerRole="Process1Requester"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="Link1"/>
                    <link name="InvokeToAssign1"/>
                    <link name="Assign1ToWhile1"/>
                </links>
                <receive createInstance="yes" name="receive" variable="input">
                    <sources>
                        <source linkName="Link1"/>
                    </sources>
                </receive>
                <assign name="Invoke" validate="no">
                    <targets>
                        <target linkName="Link1"/>
                    </targets>
                    <sources>
                        <source linkName="InvokeToAssign1"/>
                        <source linkName="InvokeTOInitCounter2"/>
                    </sources>
                    <copy>
                        <from variable="initiate1"/>
                        <to variable="initiate2"/>
                    </copy>
                </assign>
                <assign name="InitCounter1" validate="no">
                    <targets>
                        <target linkName="InvokeToAssign1"/>
                    </targets>
                    <sources>
                        <source linkName="Assign1ToWhile1"/>
                    </sources>
                    <copy>
                        <from>
                            <literal>0</literal>
                        </from>
                        <to variable="counter1"/>
                    </copy>
                </assign>
                <flow name="UnrolledLoop">
                    <targets>
                        <target linkName="Assign1ToWhile1"/>
                    </targets>
                    <links>
                        <link name="SLOOP_Process1While_Entry"/>
                        <link name="SLOOP_Next1"/>
                    </links>
                    <empty name="EntryActivity">
                        <sources>
                            <source linkName="SLOOP_Process1While_Entry">
                                <transitionCondition><![CDATA[$counter1 < 1]]></transitionCondition>
                            </source>
                        </sources>
                    </empty>
                    <flow name="Process1WhileFlow1">
                        <targets>
                            <target linkName="SLOOP_Process1While_Entry"/>
                        </targets>
                        <sources>
                            <source linkName="SLOOP_Next1">
                                <transitionCondition><![CDATA[$counter1 < 1]]></transitionCondition>
                            </source>
                        </sources>
                        <links>
                            <link name="SLOOP_Invoke1ToAssign1"/>
                            <link name="SLOOP_AssignToReceive11"/>
                        </links>
                        <assign name="Invoke1Process1" validate="no">
                            <sources>
                                <source linkName="SLOOP_Invoke1ToAssign1"/>
                                <source linkName="SLOOP_Invoke1Process1TOReceive2Process21"/>
                            </sources>
                            <copy>
                                <from variable="varInv1"/>
                                <to variable="varRec2"/>
                            </copy>
                        </assign>
                        <assign name="IncrementInput" validate="no">
                            <targets>
                                <target linkName="SLOOP_Invoke1ToAssign1"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_AssignToReceive11"/>
                            </sources>
                            <copy>
                                <from><![CDATA[$counter1 + 1]]></from>
                                <to variable="counter1"/>
                            </copy>
                        </assign>
                        <empty name="Receive1Process1">
                            <targets>
                                <joinCondition><![CDATA[$SLOOP_Invoke2Process2TOReceive1Process11 and ($SLOOP_AssignToReceive11)]]></joinCondition>
                                <target linkName="SLOOP_AssignToReceive11"/>
                                <target linkName="SLOOP_Invoke2Process2TOReceive1Process11"/>
                            </targets>
                        </empty>
                    </flow>
                    <flow name="Process1WhileFlow2">
                        <targets>
                            <target linkName="SLOOP_Next1"/>
                        </targets>
                        <links>
                            <link name="SLOOP_Invoke1ToAssign2"/>
                            <link name="SLOOP_AssignToReceive12"/>
                        </links>
                        <assign name="Invoke1Process1" validate="no">
                            <sources>
                                <source linkName="SLOOP_Invoke1ToAssign2"/>
                                <source linkName="SLOOP_Invoke1Process1TOReceive2Process22"/>
                            </sources>
                            <copy>
                                <from variable="varInv1"/>
                                <to variable="varRec2"/>
                            </copy>
                        </assign>
                        <assign name="IncrementInput" validate="no">
                            <targets>
                                <target linkName="SLOOP_Invoke1ToAssign2"/>
                            </targets>
                            <sources>
                                <source linkName="SLOOP_AssignToReceive12"/>
                            </sources>
                            <copy>
                                <from><![CDATA[$counter1 + 1]]></from>
                                <to variable="counter1"/>
                            </copy>
                        </assign>
                        <empty name="Receive1Process1">
                            <targets>
                                <joinCondition><![CDATA[$SLOOP_Invoke2Process2TOReceive1Process12 and ($SLOOP_AssignToReceive12)]]></joinCondition>
                                <target linkName="SLOOP_AssignToReceive12"/>
                                <target linkName="SLOOP_Invoke2Process2TOReceive1Process12"/>
                            </targets>
                        </empty>
                    </flow>
                </flow>
            </flow>
        </scope>
    </flow>
</process>
