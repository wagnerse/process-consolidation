<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://www.iaas.uni-stuttgart.de"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract" xmlns:ns="http://www.iaas.uni-stuttgart.de">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="P1SP30.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="P2SP30.wsdl" namespace="http://www.iaas.uni-stuttgart.de"/>
    <flow name="MergedFlow">
        <scope exitOnStandardFault="yes" name="Scope_P2SP30" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:P2SP30RequestMessage" name="input"/>
                <variable messageType="ns:P2SP30ResponseMessage" name="output"/>
                <variable messageType="ns:P12P2SP30RequestMessage" name="varRec1P2"/>
                <variable messageType="ns:P22P1SP30ResponseMessage" name="varReply1P2"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="P2SP30Provider" name="client"
                    partnerLinkType="ns:P2SP30" partnerRole="P2SP30Requester"/>
                <partnerLink myRole="P1ASP30toP2ASP30Provider"
                    name="Invoke1P1SP30TOReceive1P2SP30PLR" partnerLinkType="ns:P1SP30toP2SP30PLT"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="link1"/>
                    <link name="link5"/>
                    <link name="link6"/>
                    <link name="link4"/>
                    <link name="link8"/>
                    <link name="link3"/>
                </links>
                <receive createInstance="no" name="Receive1P2SP30"
                    operation="Invoke1toReceive1Operation"
                    partnerLink="Invoke1P1SP30TOReceive1P2SP30PLR"
                    portType="ns:P1SP30toP2SP30PT" variable="varRec1P2">
                    <targets>
                        <target linkName="link3"/>
                    </targets>
                    <sources>
                        <source linkName="link4"/>
                    </sources>
                </receive>
                <receive createInstance="yes" name="receiveInputP2SP30" variable="input">
                    <sources>
                        <source linkName="link1"/>
                    </sources>
                </receive>
                <invoke inputVariable="output" name="callbackClientP2SP30">
                    <targets>
                        <target linkName="link6"/>
                    </targets>
                </invoke>
                <empty name="Empty1">
                    <targets>
                        <target linkName="link1"/>
                    </targets>
                    <sources>
                        <source linkName="link3"/>
                    </sources>
                </empty>
                <reply name="Reply1P2SP30"
                    operation="Invoke1toReceive1Operation"
                    partnerLink="Invoke1P1SP30TOReceive1P2SP30PLR"
                    portType="ns:P1SP30toP2SP30PT" variable="varReply1P2">
                    <targets>
                        <target linkName="link8"/>
                    </targets>
                    <sources>
                        <source linkName="link5"/>
                    </sources>
                </reply>
                <empty name="Empty3">
                    <targets>
                        <target linkName="link5"/>
                    </targets>
                    <sources>
                        <source linkName="link6"/>
                    </sources>
                </empty>
                <empty name="Empty5">
                    <targets>
                        <target linkName="link4"/>
                    </targets>
                    <sources>
                        <source linkName="link8"/>
                    </sources>
                </empty>
            </flow>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_P1SP30" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns:P1SP30RequestMessage" name="input"/>
                <variable messageType="ns:P1SP30ResponseMessage" name="output"/>
                <variable messageType="ns:P12P2SP30RequestMessage" name="varInv1P1"/>
                <variable messageType="ns:P22P1SP30ResponseMessage" name="varReply1P1"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="P1SP30Provider" name="client"
                    partnerLinkType="ns:P1SP30" partnerRole="P1SP30Requester"/>
                <partnerLink name="Invoke1P1SP30TOReceive1P2SP30PLS"
                    partnerLinkType="ns:P1SP30toP2SP30PLT" partnerRole="P1ASP30toP2ASP30Provider"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="main">
                <links>
                    <link name="link1"/>
                    <link name="link4"/>
                    <link name="link2"/>
                    <link name="link5"/>
                    <link name="link6"/>
                    <link name="link3"/>
                </links>
                <receive createInstance="yes" name="receiveInputP1SP30" variable="input">
                    <sources>
                        <source linkName="link1"/>
                    </sources>
                </receive>
                <invoke inputVariable="output" name="callbackClientP1SP30">
                    <targets>
                        <target linkName="link4"/>
                    </targets>
                </invoke>
                <empty name="Empty1">
                    <targets>
                        <target linkName="link1"/>
                    </targets>
                    <sources>
                        <source linkName="link2"/>
                    </sources>
                </empty>
                <empty name="Empty2">
                    <targets>
                        <target linkName="link3"/>
                    </targets>
                    <sources>
                        <source linkName="link4"/>
                    </sources>
                </empty>
                <empty name="Empty5">
                    <sources>
                        <source linkName="link6"/>
                    </sources>
                </empty>
                <empty name="Empty6">
                    <sources>
                        <source linkName="link5"/>
                    </sources>
                </empty>
                <while name="While">
                    <targets>
                        <target linkName="link2"/>
                        <target linkName="link5"/>
                        <target linkName="link6"/>
                    </targets>
                    <sources>
                        <source linkName="link3"/>
                    </sources>
                    <condition><![CDATA[$input.payload/tns:input="Hallo"]]></condition>
                    <invoke name="Invoke1P1SP30"
                        operation="Invoke1toReceive1Operation"
                        outputVariable="varReply1P1"
                        partnerLink="Invoke1P1SP30TOReceive1P2SP30PLS" portType="ns:P1SP30toP2SP30PT"/>
                </while>
            </flow>
        </scope>
    </flow>
</process>
