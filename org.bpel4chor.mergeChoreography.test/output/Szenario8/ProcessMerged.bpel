<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://uni-stuttgart.de/iaas/bpel/SWAIL"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract"
    xmlns:ns="http://uni-stuttgart.de/iaas/bpel/SWAIL"
    xmlns:ns0="http://uni-stuttgart.de/iaas/bpel/FaultHandler" xmlns:ns1="http://uni-stuttgart.de/bpel/SimpleCallFH">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="Szenario4_SimpleFHArtifacts.wsdl" namespace="http://uni-stuttgart.de/iaas/bpel/SWAIL"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="SimpleCallFHArtifacts.wsdl" namespace="http://uni-stuttgart.de/bpel/SimpleCallFH"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="FaultHandlerArtifacts.wsdl" namespace="http://uni-stuttgart.de/iaas/bpel/FaultHandler"/>
    <variables>
        <variable messageType="ns:SWAILRequestMessage" name="input"/>
        <variable messageType="ns0:FaultHandlerRequestMessage" name="faultRequest"/>
    </variables>
    <flow name="MergedFlow">
        <links>
            <link name="callSimpleFhTOFalsche_Eingabe"/>
            <link name="callFhFromSimpleFhTOReceive_getFaultMessage"/>
        </links>
        <scope name="FH_SurScope_Scope_Szenario4_SimpleFH">
            <variables>
                <variable messageType="ns0:FaultHandlerResponseMessage" name="faultResponse"/>
            </variables>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <flow name="FH_Processing_Scope_Szenario4_SimpleFH">
                <links>
                    <link name="a57760ae-646e-407d-8ef1-dde33751a2b9"/>
                    <link name="761514fa-5e63-4b0c-973e-1b02aa1ae5a6"/>
                    <link name="e652bace-8a34-4cb3-b675-ff3f8a7d5ce5"/>
                </links>
                <empty name="continueProcess">
                    <targets>
                        <target linkName="761514fa-5e63-4b0c-973e-1b02aa1ae5a6"/>
                        <target linkName="e652bace-8a34-4cb3-b675-ff3f8a7d5ce5"/>
                    </targets>
                </empty>
                <scope name="Scope_Szenario4_SimpleFH_catch">
                    <targets>
                        <target linkName="a57760ae-646e-407d-8ef1-dde33751a2b9"/>
                    </targets>
                    <sources>
                        <source linkName="761514fa-5e63-4b0c-973e-1b02aa1ae5a6"/>
                    </sources>
                    <compensationHandler>
                        <empty/>
                    </compensationHandler>
                    <sequence>
                        <empty name="Receive_getFaultMessage">
                            <targets>
                                <target linkName="callFhFromSimpleFhTOReceive_getFaultMessage"/>
                            </targets>
                        </empty>
                        <assign name="Assign_faultMessage" validate="no">
                            <copy>
                                <from>
                                    <literal>
                                    <tns:FaultHandlerResponse
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/FaultHandler" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:result>tns:result</tns:result>
                                    </tns:FaultHandlerResponse>
                                    </literal>
                                </from>
                                <to part="payload" variable="faultResponse"/>
                            </copy>
                            <copy>
                                <from variable="input"/>
                                <to part="payload" variable="faultResponse">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[fh:result]]></query>
                                </to>
                            </copy>
                        </assign>
                        <empty name="Reply_faultMessage"/>
                    </sequence>
                </scope>
                <scope exitOnStandardFault="yes"
                    name="Scope_Szenario4_SimpleFH" suppressJoinFailure="yes">
                    <sources>
                        <source linkName="e652bace-8a34-4cb3-b675-ff3f8a7d5ce5"/>
                    </sources>
                    <correlationSets>
                        <correlationSet name="startCorFaultHandler" properties="startcfhp"/>
                    </correlationSets>
                    <faultHandlers>
                        <catch>
                            <empty>
                                <sources>
                                    <source linkName="a57760ae-646e-407d-8ef1-dde33751a2b9"/>
                                </sources>
                            </empty>
                        </catch>
                        <catchAll>
                            <compensate/>
                        </catchAll>
                    </faultHandlers>
                    <sequence name="main">
                        <throw name="Falsche_Eingabe">
                            <targets>
                                <target linkName="callSimpleFhTOFalsche_Eingabe"/>
                            </targets>
                        </throw>
                    </sequence>
                </scope>
            </flow>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_SimpleCallFH" suppressJoinFailure="yes">
            <variables>
                <variable name="RequestMainSimpleFh"/>
                <variable messageType="ns1:SimpleCallFHRequestMessage" name="startVarRequest"/>
                <variable name="fhProviderResponse"/>
                <variable name="fhProviderRequest"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="SimpleCallFHProvider" name="client" partnerLinkType="ns1:SimpleCallFH"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <sequence name="main">
                <receive createInstance="yes" name="getCorId" variable="startVarRequest"/>
                <assign name="corTocall" validate="no">
                    <copy>
                        <from>
                            <literal>
                                <tns:SWAILRequest
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/SWAIL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:corId>tns:corId</tns:corId>
                                    <tns:input>tns:input</tns:input>
                                </tns:SWAILRequest>
                            </literal>
                        </from>
                        <to part="payload" variable="RequestMainSimpleFh"/>
                    </copy>
                    <copy>
                        <from part="payload" variable="startVarRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></query>
                        </from>
                        <to part="payload" variable="RequestMainSimpleFh">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[fh:corId]]></query>
                        </to>
                    </copy>
                    <copy>
                        <from part="payload" variable="startVarRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></query>
                        </from>
                        <to part="payload" variable="RequestMainSimpleFh">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[fh:input]]></query>
                        </to>
                    </copy>
                </assign>
                <assign name="callSimpleFh" validate="no">
                    <sources>
                        <source linkName="callSimpleFhTOFalsche_Eingabe"/>
                    </sources>
                    <copy>
                        <from variable="RequestMainSimpleFh"/>
                        <to variable="input"/>
                    </copy>
                </assign>
                <assign name="cortToCall" validate="no">
                    <copy>
                        <from>
                            <literal>
                                <tns:FaultHandlerRequest
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/FaultHandler" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:input>tns:input</tns:input>
                                </tns:FaultHandlerRequest>
                            </literal>
                        </from>
                        <to part="payload" variable="fhProviderRequest"/>
                    </copy>
                    <copy>
                        <from part="payload" variable="startVarRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></query>
                        </from>
                        <to part="payload" variable="fhProviderRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:input]]></query>
                        </to>
                    </copy>
                </assign>
                <assign name="callFhFromSimpleFh" validate="no">
                    <sources>
                        <source linkName="callFhFromSimpleFhTOReceive_getFaultMessage"/>
                    </sources>
                    <copy>
                        <from variable="fhProviderRequest"/>
                        <to variable="faultRequest"/>
                    </copy>
                </assign>
            </sequence>
        </scope>
    </flow>
</process>
