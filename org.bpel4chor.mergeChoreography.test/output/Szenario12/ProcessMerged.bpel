<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://uni-stuttgart.de/bpel/TerminationTest"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract"
    xmlns:ns="http://uni-stuttgart.de/iaas/bpel/BpelPrinter"
    xmlns:ns0="http://uni-stuttgart.de/bpel/TerminationTest"
    xmlns:ns1="http://webservice.iaas.uni_stuttgart.de" xmlns:ns2="http://www.w3.org/2001/XMLSchema">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="TerminationTestArtifacts.wsdl" namespace="http://uni-stuttgart.de/bpel/TerminationTest"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="BpelPrinterException.wsdl" namespace="http://webservice.iaas.uni_stuttgart.de"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="BpelPrinterArtifacts.wsdl" namespace="http://uni-stuttgart.de/iaas/bpel/BpelPrinter"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="BPELPrinter.wsdl" namespace="http://webservice.iaas.uni_stuttgart.de"/>
    <variables>
        <variable messageType="ns:BpelPrinterRequestMessage" name="input"/>
    </variables>
    <flow name="MergedFlow">
        <links>
            <link name="callBpelPrinterTOEingabe_Zuweisen"/>
        </links>
        <scope exitOnStandardFault="yes" name="Scope_TerminationTest" suppressJoinFailure="yes">
            <variables>
                <variable
                    messageType="ns0:TerminationTestRequestMessage" name="input"/>
                <variable messageType="ns1:printRuntimeResponse" name="BpePLNResponse"/>
                <variable messageType="ns1:printRuntimeRequest" name="BpePLNRequest"/>
                <variable messageType="ns1:printResponse" name="BpePLNResponse1"/>
                <variable messageType="ns1:printRequest" name="BpePLNRequest1"/>
                <variable name="errorMessage" type="ns2:string"/>
                <variable messageType="ns1:MyServiceException" name="faultVarResult"/>
                <variable name="printerRequest"/>
                <variable name="directPrinterRequest"/>
                <variable name="directPrinterResponse"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="TerminationTestProvider" name="client" partnerLinkType="ns0:TerminationTest"/>
                <partnerLink initializePartnerRole="no" name="BpePLN"
                    partnerLinkType="ns0:BpePLT" partnerRole="bpeProvider"/>
                <partnerLink initializePartnerRole="no" name="directPrinterPLN"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <sequence name="main">
                <receive createInstance="yes" name="receiveInput" variable="input"/>
                <assign name="Assign" validate="no">
                    <copy>
                        <from>
                            <literal>
                                <impl:printRuntime
                                    xmlns:impl="http://webservice.iaas.uni_stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                            </literal>
                        </from>
                        <to part="parameters" variable="BpePLNRequest"/>
                    </copy>
                    <copy>
                        <from>
                            <literal>
                                <impl:print
                                    xmlns:impl="http://webservice.iaas.uni_stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                            </literal>
                        </from>
                        <to part="parameters" variable="BpePLNRequest1"/>
                    </copy>
                    <copy>
                        <from>
                            <literal>
                                <tns:BpelPrinterRequest
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/BpelPrinter" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:input>init</tns:input>
                                </tns:BpelPrinterRequest>
                            </literal>
                        </from>
                        <to part="payload" variable="printerRequest"/>
                    </copy>
                    <copy>
                        <from>
                            <literal>
                                <impl:printInformation
                                    xmlns:impl="http://webservice.iaas.uni_stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <impl:information/>
                                </impl:printInformation>
                            </literal>
                        </from>
                        <to part="parameters" variable="directPrinterRequest"/>
                    </copy>
                </assign>
                <scope exitOnStandardFault="no" isolated="no" name="Scope">
                    <faultHandlers>
                        <catch faultMessageType="ns1:MyServiceException"
                            faultName="ns1:MyServiceException" faultVariable="faultVar">
                            <sequence>
                                <wait name="Wait">
                                    <for><![CDATA['PT5S']]></for>
                                </wait>
                                <assign name="varZuweisung" validate="no">
                                    <copy>
                                    <from variable="faultVar"/>
                                    <to variable="faultVarResult"/>
                                    </copy>
                                    <copy>
                                    <from>
                                    <literal>##################################################
MyServiceException.
##################################################</literal>
                                    </from>
                                    <to part="parameters" variable="directPrinterRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:information]]></query>
                                    </to>
                                    </copy>
                                </assign>
                                <invoke
                                    inputVariable="directPrinterRequest"
                                    name="InvokePrint" outputVariable="directPrinterResponse"/>
                            </sequence>
                        </catch>
                    </faultHandlers>
                    <terminationHandler>
                        <sequence name="TerminationHandler">
                            <assign name="Assign" validate="no">
                                <copy>
                                    <from>
                                    <literal>##################################################
TerminationHandler aktiviert. Umfassender Scope
##################################################</literal>
                                    </from>
                                    <to part="parameters" variable="directPrinterRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:information]]></query>
                                    </to>
                                </copy>
                            </assign>
                            <invoke inputVariable="directPrinterRequest"
                                name="InvokePrint" outputVariable="directPrinterResponse"/>
                        </sequence>
                    </terminationHandler>
                    <flow>
                        <links/>
                        <scope exitOnStandardFault="no" isolated="no" name="waitScope">
                            <terminationHandler>
                                <sequence name="TerminationHandler">
                                    <assign name="Assign" validate="no">
                                    <copy>
                                    <from>
                                    <literal>##################################################
TerminationHandler aktiviert. Scope: Warte
##################################################</literal>
                                    </from>
                                    <to part="payload" variable="printerRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[printer:input]]></query>
                                    </to>
                                    </copy>
                                    </assign>
                                    <assign name="callBpelPrinter" validate="no">
                                    <sources>
                                    <source linkName="callBpelPrinterTOEingabe_Zuweisen"/>
                                    </sources>
                                    <copy>
                                    <from variable="printerRequest"/>
                                    <to variable="input"/>
                                    </copy>
                                    </assign>
                                </sequence>
                            </terminationHandler>
                            <sequence>
                                <assign name="Assign" validate="no">
                                    <copy>
                                    <from>
                                    <literal>##################################################
Start Wait.
##################################################</literal>
                                    </from>
                                    <to part="parameters" variable="directPrinterRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:information]]></query>
                                    </to>
                                    </copy>
                                </assign>
                                <invoke
                                    inputVariable="directPrinterRequest"
                                    name="InvokePrint" outputVariable="directPrinterResponse"/>
                                <wait name="Wait">
                                    <for><![CDATA['PT30S']]></for>
                                </wait>
                                <assign name="Assign" validate="no">
                                    <copy>
                                    <from>
                                    <literal>##################################################
Finish Wait.
##################################################</literal>
                                    </from>
                                    <to part="parameters" variable="directPrinterRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:information]]></query>
                                    </to>
                                    </copy>
                                </assign>
                                <invoke
                                    inputVariable="directPrinterRequest"
                                    name="InvokePrint" outputVariable="directPrinterResponse"/>
                            </sequence>
                        </scope>
                        <scope exitOnStandardFault="no" isolated="no" name="FaultScope">
                            <terminationHandler>
                                <sequence name="TerminationHandler">
                                    <assign name="Assign" validate="no">
                                    <copy>
                                    <from>
                                    <literal>##################################################
TerminationHandler aktiviert. Scope: Werfe Fehler
##################################################</literal>
                                    </from>
                                    <to part="parameters" variable="directPrinterRequest">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:information]]></query>
                                    </to>
                                    </copy>
                                    </assign>
                                    <invoke
                                    inputVariable="directPrinterRequest"
                                    name="InvokePrint" outputVariable="directPrinterResponse"/>
                                </sequence>
                            </terminationHandler>
                            <sequence>
                                <wait name="Wait">
                                    <for><![CDATA['PT5S']]></for>
                                </wait>
                                <invoke inputVariable="BpePLNRequest1"
                                    name="InvokeException" outputVariable="BpePLNResponse1"/>
                            </sequence>
                        </scope>
                    </flow>
                </scope>
                <assign name="ZuweisungNachError" validate="no">
                    <copy>
                        <from>
                            <literal>Nach Fault</literal>
                        </from>
                        <to variable="errorMessage"/>
                    </copy>
                </assign>
            </sequence>
        </scope>
        <scope exitOnStandardFault="yes" name="Scope_BpelPrinter" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns1:printInformationRequest" name="printerRequest"/>
                <variable messageType="ns1:printInformationResponse" name="printerResponse"/>
            </variables>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    name="PrinterWebservice"
                    partnerLinkType="ns:PrinterWebservicePartnerLinkType" partnerRole="clientPrinterWebservice"/>
            </partnerLinks>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <sequence name="main">
                <assign name="Eingabe_Zuweisen" validate="no">
                    <targets>
                        <target linkName="callBpelPrinterTOEingabe_Zuweisen"/>
                    </targets>
                    <copy>
                        <from>
                            <literal>
                                <impl:printInformation
                                    xmlns:impl="http://webservice.iaas.uni_stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <impl:information>impl:information</impl:information>
                                </impl:printInformation>
                            </literal>
                        </from>
                        <to part="parameters" variable="printerRequest"/>
                    </copy>
                    <copy>
                        <from part="payload" variable="input">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></query>
                        </from>
                        <to part="parameters" variable="printerRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[pb:information]]></query>
                        </to>
                    </copy>
                </assign>
                <invoke inputVariable="printerRequest" name="Invoke" outputVariable="printerResponse"/>
            </sequence>
        </scope>
    </flow>
</process>
