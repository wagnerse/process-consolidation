<?xml version="1.0" encoding="UTF-8"?>
<process
    abstractProcessProfile="urn:HPI_IAAS:choreography:profile:2006/12"
    exitOnStandardFault="yes" name="ProcessMerged"
    suppressJoinFailure="yes"
    targetNamespace="http://uni-stuttgart.de/iaas/bpel/ScenarioWithAsyncIncomingLink"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/abstract"
    xmlns:ns="http://uni-stuttgart.de/bpel/ScenarioWAILSupport"
    xmlns:ns0="http://uni-stuttgart.de/iaas/bpel/ScenarioWithAsyncIncomingLink"
    xmlns:ns1="http://www.w3.org/2001/XMLSchema" xmlns:ns2="http://uni-stuttgart.de/iaas/bpel/AsyncReply">
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="ScenarioWithAsyncIncomingLinkArtifacts.wsdl" namespace="http://uni-stuttgart.de/iaas/bpel/ScenarioWithAsyncIncomingLink"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="ScenarioWAILSupportArtifacts.wsdl" namespace="http://uni-stuttgart.de/bpel/ScenarioWAILSupport"/>
    <import importType="http://schemas.xmlsoap.org/wsdl/"
        location="AsyncReply.wsdl" namespace="http://uni-stuttgart.de/iaas/bpel/AsyncReply"/>
    <variables>
        <variable messageType="ns:ScenarioWAILSupportRequestMessage" name="input"/>
    </variables>
    <flow name="MergedFlow">
        <links>
            <link name="callSwailSupportTOAssign_cor"/>
        </links>
        <scope exitOnStandardFault="yes"
            name="Scope_ScenarioWithAsyncIncomingLink" suppressJoinFailure="yes">
            <variables>
                <variable
                    messageType="ns0:ScenarioWithAsyncIncomingLinkRequestMessage" name="input"/>
                <variable
                    messageType="ns0:ScenarioWithAsyncIncomingLinkResponseMessage" name="output"/>
                <variable name="errorMessage" type="ns1:string"/>
                <variable
                    messageType="ns:ScenarioWAILSupportRequestMessage" name="RequestSupporter"/>
                <variable messageType="ns2:AsyncReplyRequestMessage" name="ResponseSupport"/>
            </variables>
            <correlationSets>
                <correlationSet name="CorrelationSet" properties="corRefP1toP2"/>
            </correlationSets>
            <partnerLinks>
                <partnerLink initializePartnerRole="no"
                    myRole="ScenarioWithAsyncIncomingLinkProvider"
                    name="client" partnerLinkType="ns0:ScenarioWithAsyncIncomingLink"/>
            </partnerLinks>
            <faultHandlers>
                <catch>
                    <sequence>
                        <assign name="Error" validate="no">
                            <copy>
                                <from>
                                    <literal>
                                    <tns:ScenarioWAILSupportRequest
                                    xmlns:tns="http://uni-stuttgart.de/bpel/ScenarioWAILSupport" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:corId>tns:corId</tns:corId>
                                    </tns:ScenarioWAILSupportRequest>
                                    </literal>
                                </from>
                                <to part="payload" variable="RequestSupporter"/>
                            </copy>
                            <copy>
                                <from>
                                    <literal>Es ist ein Fehler aufgetreten.</literal>
                                </from>
                                <to variable="errorMessage"/>
                            </copy>
                            <copy>
                                <from>
                                    <literal>21602</literal>
                                </from>
                                <to part="payload" variable="RequestSupporter">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[swailsupport:corId]]></query>
                                </to>
                            </copy>
                        </assign>
                        <assign name="callSwailSupport" validate="no">
                            <sources>
                                <source linkName="callSwailSupportTOAssign_cor"/>
                            </sources>
                            <copy>
                                <from variable="RequestSupporter"/>
                                <to variable="input"/>
                            </copy>
                        </assign>
                        <empty name="receiveSwailSupport"/>
                    </sequence>
                </catch>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <sequence name="main">
                <receive createInstance="yes" name="receiveInput" variable="input"/>
                <assign name="Assign" validate="no">
                    <copy>
                        <from>
                            <literal>

                                <tns:ScenarioWithAsyncIncomingLinkResponse
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/ScenarioWithAsyncIncomingLink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:result>tns:result</tns:result>
                                </tns:ScenarioWithAsyncIncomingLinkResponse>
                            </literal>
                        </from>
                        <to part="payload" variable="output"/>
                    </copy>
                    <copy>
                        <from part="payload" variable="input">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></query>
                        </from>
                        <to part="payload" variable="output">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:result]]></query>
                        </to>
                    </copy>
                </assign>
                <if name="If">
                    <condition><![CDATA[$input.payload/tns:input="Hallo"]]></condition>
                    <sequence>
                        <assign name="Fehler_ausgabe" validate="no">
                            <copy>
                                <from>
                                    <literal>Es wird ein Fehler geworfen</literal>
                                </from>
                                <to part="payload" variable="output">
                                    <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:result]]></query>
                                </to>
                            </copy>
                        </assign>
                        <reply name="replyOutput" variable="output"/>
                        <throw name="Falsche_Eingabe"/>
                    </sequence>
                    <else>
                        <sequence name="Sequence">
                            <reply name="ReplyOutput_ohne_Fehler" variable="output"/>
                        </sequence>
                    </else>
                </if>
            </sequence>
        </scope>
        <scope exitOnStandardFault="yes"
            name="Scope_ScenarioWAILSupport" suppressJoinFailure="yes">
            <variables>
                <variable messageType="ns2:AsyncReplyRequestMessage" name="providerRequest"/>
            </variables>
            <correlationSets>
                <correlationSet name="CorrelationSet" properties="corRefP2toP1"/>
            </correlationSets>
            <faultHandlers>
                <catchAll>
                    <compensate/>
                </catchAll>
            </faultHandlers>
            <sequence name="main">
                <assign name="Assign_cor" validate="no">
                    <targets>
                        <target linkName="callSwailSupportTOAssign_cor"/>
                    </targets>
                    <copy>
                        <from>
                            <literal>
                                <tns:AsyncReplyRequest
                                    xmlns:tns="http://uni-stuttgart.de/iaas/bpel/AsyncReply" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    <tns:corId>tns:corId</tns:corId>
                                </tns:AsyncReplyRequest>
                            </literal>
                        </from>
                        <to part="payload" variable="providerRequest"/>
                    </copy>
                    <copy>
                        <from variable="input"/>
                        <to part="payload" variable="providerRequest">
                            <query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ar:corId]]></query>
                        </to>
                    </copy>
                </assign>
                <wait name="Wait">
                    <for><![CDATA['PT30S']]></for>
                </wait>
                <empty name="swailCallbackClient"/>
            </sequence>
        </scope>
    </flow>
</process>
